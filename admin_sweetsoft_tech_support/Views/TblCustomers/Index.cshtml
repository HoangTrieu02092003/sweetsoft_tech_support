@inject IHttpContextAccessor HttpContextAccessor
@model IEnumerable<admin_sweetsoft_tech_support.Models.TblCustomer>

@{
    ViewData["Title"] = "Quản lý Khách hàng";
    Layout = "~/Views/Shared/_Layout_admin.cshtml";
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">
        @TempData["ErrorMessage"]
    </div>
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link href="~/css/index_user.css" rel="stylesheet">

<div class="d-flex justify-content-between align-items-center mb-0">
    <h1 class=" my-4" style="color: #6a1b9a; font-size: 24px;">Quản lý Khách hàng</h1>
    <a asp-action="Create" class="btn btn-warning text-dark">
        <i class="bi bi-plus-circle"></i> Tạo mới
    </a>
</div>

<div class="card-container">
    @foreach (var item in Model)
    {
        <div class="card">
            <h5 class="card-title">@item.FullName</h5>
            <p><strong>Email:</strong> @item.Email</p>
            <p><strong>Số điện thoại:</strong> @item.Phone</p>
            <p><strong>Tên đăng nhập:</strong> @item.Username</p>
            <p><strong>Mật khẩu:</strong> @item.Password</p>
            <p>
                <strong>Trạng thái:</strong>
                <span class="badge @((item.Status == 1) ? "bg-success" : "bg-danger")">
                    @(item.Status == 1 ? "Kích hoạt" : "Chưa kích hoạt")
                </span>
            </p>
            <p><strong>Người tạo:</strong> @item.CreatedUserNavigation?.FullName </p
            <p><strong>Người cập nhật:</strong> @item.UpdatedUserNavigation?.FullName</p>

            <p><strong>Ngày tạo:</strong> @item.CreatedAt?.ToString("dd/MM/yyyy")</p>
            <p><strong>Ngày cập nhật:</strong> @item.UpdatedAt?.ToString("dd/MM/yyyy")</p>
            <div class="card-actions">
                <a asp-action="Edit" asp-route-id="@item.CustomerId" class="btn btn-outline-primary">
                    <i class="bi bi-pencil-square"></i> <span>Thông tin</span>
                </a>
                <form method="post" asp-action="ToggleActivation" asp-route-customerId="@item.CustomerId" class="d-inline">
    <button type="submit" class="btn btn-outline-info">
        <i class="bi bi-gear"></i> 
        <span>@((item.Status == 1) ?  "Chưa kích hoạt" : "Kích hoạt")</span>
    </button>
</form>

                <button class="btn btn-outline-danger " data-bs-toggle="modal" data-bs-target="#deleteModal-@item.CustomerId">
                    <i class="bi bi-trash"></i> <span>Xóa</span>
                </button>
            </div>
        </div>

        <!-- Modal Xác Nhận Xóa -->
        <div class="modal fade" id="deleteModal-@item.CustomerId" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteModalLabel">Xác nhận xóa người dùng</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        Bạn có chắc chắn muốn xóa người dùng này không?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                        <form method="post" asp-action="Delete" asp-route-id="@item.CustomerId">
                            <button type="submit" class="btn btn-danger">Xóa</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    }
</div>

<!-- Phân trang -->
<div class="d-flex justify-content-center my-4">
    <ul class="pagination">
        @if (ViewData["CurrentPage"] != null && (int)ViewData["CurrentPage"] > 1)
        {
            <li class="page-item">
                <a class="page-link" href="@Url.Action("Index", new { page = 1 })">Đầu</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="@Url.Action("Index", new { page = (int)ViewData["CurrentPage"] - 1 })">Trước</a>
            </li>
        }

        @if (ViewData["TotalPages"] != null)
        {
            int totalPages = (int)ViewData["TotalPages"];
            for (int i = 1; i <= totalPages; i++)
            {
                <li class="page-item @(i == (int)ViewData["CurrentPage"] ? "active" : "")">
                    <a class="page-link" href="@Url.Action("Index", new { page = i })">@i</a>
                </li>
            }
        }

        @if (ViewData["CurrentPage"] != null && (int)ViewData["CurrentPage"] < (int)ViewData["TotalPages"])
        {
            <li class="page-item">
                <a class="page-link" href="@Url.Action("Index", new { page = (int)ViewData["CurrentPage"] + 1 })">Sau</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="@Url.Action("Index", new { page = (int)ViewData["TotalPages"] })">Cuối</a>
            </li>
        }
    </ul>
</div>
